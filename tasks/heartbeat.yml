---

- name: Install bernhard client for centos
  pip:
    name: bernhard
    executable: /usr/local/bin/pip
  when: ansible_os_family == "RedHat"

- name: Install bernhard client for ubuntu
  pip:
    name: bernhard
  when: ansible_os_family == "Debian"

- name: Create the script for heartbeat
  template:
    src: riemannHeartbeat.py
    dest: /root/riemannHeartbeat.py
    owner: root
    group: root
    mode: 0777

- name: Setup upstart script for heartbeat
  template:
    src: heartbeat.conf
    dest: /etc/init/heartbeat_to_riemann.conf
    owner: root
    group: root
    mode: 0777

- name: Start the heartbeat script for ubuntu
  service:
    name: heartbeat_to_riemann
    state: started
  when: ansible_os_family == "Debian"

- name: Start the heartbeat script for centos
  command: /sbin/initctl start heartbeat_to_riemann
  changed_when: false
  when: ansible_os_family == "RedHat"
